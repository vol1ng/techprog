# Техническая документация приложения

## Обзор проекта
Приложение представляет собой веб-игру для изучения английского языка, построенную на современном стеке технологий:

### Frontend
- **HTML5/CSS3**: Современная верстка с поддержкой адаптивного дизайна
- **JavaScript (ES6+)**: 
  - Чистый JavaScript без фреймворков
  - Модульная архитектура
  - Асинхронные операции через Promises и async/await
  - DOM-манипуляции и обработка событий

### Backend
- **Node.js**: 
  - Express.js для создания REST API
  - Middleware для аутентификации и логирования
  - Обработка статических файлов
  - Маршрутизация запросов
- **PostgreSQL**:
  - Реляционная база данных
  - Сложные SQL-запросы и JOIN'ы
  - Транзакции и ACID-свойства
  - Индексация для оптимизации запросов
  - Миграции для управления схемой БД

### Архитектура
1. **Многоуровневая архитектура**:
   - Презентационный слой (Frontend)
   - Бизнес-логика (Backend)
   - Слой данных (PostgreSQL)

2. **Модульная структура**:
   - Разделение на независимые компоненты
   - Четкие границы между модулями
   - Возможность легкого расширения

3. **Безопасность**:
   - JWT-аутентификация
   - Хеширование паролей (bcrypt)
   - Защита от SQL-инъекций
   - Валидация входных данных
   - CORS-политики

## Структура проекта
```
├── server.js          # Express сервер, обработка HTTP запросов
├── main.js           # Основная логика клиентской части
├── auth.js           # Аутентификация и авторизация
├── db.js             # Работа с PostgreSQL
├── api.js            # REST API endpoints
├── game.js           # Логика игрового процесса
├── level.js          # Управление уровнями
├── switchTheme.js    # Переключение темы оформления
├── database.sql      # Схема базы данных
├── dict.json         # Словарь английских слов
├── Wordsru.json      # Русский словарь
└── level*.html/json  # Файлы уровней
```

## Основные компоненты

### Серверная часть
- `server.js`: 
  - Настройка Express сервера
  - Middleware конфигурация
  - Обработка HTTP запросов
  - Маршрутизация
- `db.js`: 
  - Подключение к PostgreSQL
  - Пул соединений
  - Транзакции
  - Миграции
- `api.js`: 
  - REST API endpoints
  - Валидация запросов
  - Обработка ошибок
  - Форматирование ответов

### Клиентская часть
- `main.js`: 
  - Инициализация приложения
  - Управление состоянием
  - Обработка событий
- `game.js`: 
  - Игровая механика
  - Валидация ответов
  - Подсчет очков
- `level.js`: 
  - Управление уровнями
  - Загрузка контента
  - Прогресс пользователя
- `auth.js`: 
  - Аутентификация
  - Управление сессиями
  - Защита маршрутов

## База данных
PostgreSQL содержит следующие основные таблицы:
- `users`: 
  - id (PRIMARY KEY)
  - username
  - email
  - password_hash
  - created_at
  - last_login
- `progress`: 
  - user_id (FOREIGN KEY)
  - level_id
  - completed
  - score
  - attempts
- `scores`: 
  - id (PRIMARY KEY)
  - user_id (FOREIGN KEY)
  - level_id
  - score
  - time_spent
  - completed_at

## API Endpoints
- `POST /api/register` - регистрация пользователя
- `POST /api/login` - авторизация
- `GET /api/levels` - получение списка уровней
- `POST /api/scores` - сохранение результатов
- `GET /api/progress` - получение прогресса пользователя

## Установка и запуск
1. Установить Node.js (версия 14+)
2. Установить PostgreSQL (версия 12+)
3. Создать базу данных и пользователя
4. Выполнить `npm install`
5. Настроить переменные окружения
6. Запустить миграции: `npm run migrate`
7. Запустить сервер: `npm start`
8. Открыть http://localhost:3000


## Безопасность
- Все пароли хешируются с использованием bcrypt
- Используется JWT для аутентификации
- Валидация всех пользовательских входных данных
- Защита от SQL-инъекций
- CORS-политики
- Rate limiting
- Защита от XSS-атак

## Масштабирование
- Возможность добавления новых уровней через JSON-конфигурацию
- Модульная структура для легкого расширения функционала
- Поддержка мультиязычности
- Кэширование на уровне приложения
- Оптимизация запросов к БД
- Горизонтальное масштабирование через балансировщик нагрузки 